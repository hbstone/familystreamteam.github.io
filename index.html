<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="robots" content="noindex">
  <title>Family Stream Team</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; padding: 1rem; }
    header { display: flex; gap: 1rem; align-items: center; flex-wrap: wrap; }
    input[type="search"] { flex: 1; min-width: 220px; padding: .6rem .8rem; border: 1px solid #ddd; border-radius: 8px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px,1fr)); gap: 14px; margin-top: 1rem; }
    .card { cursor: pointer; border: 1px solid #eee; border-radius: 12px; overflow: hidden; background: #fff; display: flex; flex-direction: column; }
    .thumb { aspect-ratio: 16/9; width: 100%; object-fit: cover; background: #f5f5f5; }
    .meta { padding: .75rem; }
    .title { font-size: 15px; font-weight: 600; margin: 0; line-height: 1.3; }
    .tags { color: #666; font-size: 12px; margin-top: .3rem; }
    dialog { width: min(960px, 95vw); border: none; border-radius: 14px; padding: 0; overflow: hidden; }
    .modal-head { display:flex; justify-content: space-between; align-items: center; padding:.6rem .8rem; border-bottom:1px solid #eee; }
    .modal-body { aspect-ratio: 16/9; }
    .close { border: 1px solid #ddd; background: #fff; border-radius: 8px; padding: .35rem .6rem; cursor: pointer; }
  </style>
</head>
<body>
  <header>
    <h1 style="margin:0;font-size:20px;">Family Stream Team</h1>
    <input id="q" type="search" placeholder="Search title, tags..." />
  </header>

  <section class="grid" id="grid"></section>

  <dialog id="playerDialog">
    <div class="modal-head">
      <div id="modalTitle" style="font-weight:600"></div>
      <button class="close" onclick="closePlayer()">Close</button>
    </div>
    <div class="modal-body">
      <iframe id="playerFrame" src="" width="100%" height="100%" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>
    </div>
    <div style="padding:.8rem;border-top:1px solid #eee">
      <div id="modalDesc" style="color:#444;font-size:14px;line-height:1.45"></div>
    </div>
  </dialog>

  <script>
    const state = { items: [], filtered: [] };

    async function load() {
      const res = await fetch('videos.json', { cache: 'no-cache' });
      state.items = await res.json();
      state.items.sort((a,b) => (b.date||'').localeCompare(a.date||''));
      state.filtered = state.items;
      render();
      // Deep link ?v=id
      const params = new URLSearchParams(location.search);
      const vid = params.get('v');
      if (vid) {
        const item = state.items.find(x => x.id === vid);
        if (item) openPlayer(item);
      }
    }

    function render() {
      const g = document.getElementById('grid');
      g.innerHTML = state.filtered.map(item => `
        <article class="card" data-id="${item.id}" role="button" tabindex="0">
          <img class="thumb" loading="lazy" src="${item.thumb}" alt="">
          <div class="meta">
            <h3 class="title">${escapeHtml(item.title)}</h3>
            <div class="tags">${(item.tags || []).map(t => `#${escapeHtml(t)}`).join(" ")}</div>
          </div>
        </article>
      `).join("");
      
      // hook up click/keyboard for each card
      g.querySelectorAll(".card").forEach(card => {
        const handle = () => {
          const id = card.dataset.id;
          const item = state.items.find(v => v.id === id);
          if (item) openPlayer(item);
        };
        card.addEventListener("click", handle);
        card.addEventListener("keydown", e => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            handle();
          }
        });
      });
    }
    
    function escapeHtml(s){ return (s||'').replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

    function openPlayer(item) {
      const d = document.getElementById('playerDialog');
      document.getElementById('modalTitle').textContent = item.title || '';
      document.getElementById('modalDesc').textContent = item.description || '';
      const f = document.getElementById('playerFrame');
      f.src = item.embed; // Gumlet embed URL
      if (!d.open) d.showModal();
      history.replaceState(null, '', `?v=${encodeURIComponent(item.id)}`);
    }

    function closePlayer() {
      const d = document.getElementById('playerDialog');
      const f = document.getElementById('playerFrame');
      f.src = 'about:blank';
      d.close();
      history.replaceState(null, '', location.pathname);
    }

    document.getElementById('q').addEventListener('input', e => {
      const q = e.target.value.trim().toLowerCase();
      if (!q) { state.filtered = state.items; render(); return; }
      state.filtered = state.items.filter(v => {
        const hay = [v.title, v.description, ...(v.tags||[])].join(' ').toLowerCase();
        return hay.includes(q);
      });
      render();
    });

    load();
  </script>
</body>
</html>
